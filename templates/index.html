<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>é€šç”¨ç”³è¯·è¡¨å•</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="/static/theme.js"></script>
  <style>
    :root {
      --bg-light:#f7f7f7; --card-light:#fff; --text-light:#000;
      --bg-dark:#1a1a1a; --card-dark:#2a2a2a; --text-dark:#f5f5f5;
      --bd:#e5e5e5; --muted:#666;
      --primary:#0a58ff; --shadow:rgba(0,0,0,.12);
    }

    body {
      background: var(--bg-light);
      color: var(--text-light);
      padding:24px;
      transition: background .4s ease, color .4s ease;
    }
    body.dark { background: var(--bg-dark); color: var(--text-dark); }

    h1,h2,h3,label,.muted,.tabs button,.nav-title{font-family:"Microsoft YaHei","å¾®è½¯é›…é»‘",sans-serif;}
    h1{font-size:32px;font-weight:900;text-align:center;margin:0 0 6px}
    h3{font-size:16px;text-align:center;margin:0 0 18px;font-weight:700;color:#444}
    body.dark h3{color:#ccc;}

    /* ğŸŒ— åˆ‡æ¢ä¸»é¢˜æŒ‰é’® */
    .toggle-theme {
      display:block; margin:0 auto 16px;
      padding:8px 16px; border:none; border-radius:10px;
      font-weight:700; cursor:pointer;
      background:linear-gradient(145deg,#f3f4f6,#e5e7eb);
      color:#111;
      box-shadow:0 3px 6px rgba(0,0,0,.2);
      transition:.3s;
    }
    body.dark .toggle-theme {
      background:linear-gradient(145deg,#3a3a3a,#1f1f1f);
      color:#f5f5f5;
      box-shadow:0 3px 6px rgba(255,255,255,.2);
    }

    .tabs{display:flex;justify-content:center;gap:14px;margin:10px 0 22px}
    .btn-tab{
      position:relative; padding:10px 18px; border-radius:12px; border:1px solid var(--bd);
      background:#fff; cursor:pointer; font-weight:800;
      box-shadow:0 3px 0 #cfd6ff, 0 8px 16px var(--shadow);
      transition:transform .08s ease, box-shadow .15s ease;
    }
    .btn-tab:hover{transform:translateY(-1px);}
    body.dark .btn-tab{background:var(--card-dark); color:var(--text-dark); border:1px solid #555;}

    form{max-width:1000px;margin:0 auto}
    .card{
      background:var(--card-light);border:1px solid var(--bd);border-radius:16px;
      padding:16px 18px;margin-bottom:16px;box-shadow:0 6px 16px var(--shadow);
      transition: background .4s ease;
    }
    body.dark .card{background:var(--card-dark);border:1px solid #444;}

    .card h2{display:flex;align-items:center;gap:10px;font-size:20px;font-weight:900;margin:0 0 12px}
    .icon{width:22px;height:22px;display:inline-flex;align-items:center;justify-content:center}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row{display:flex;flex-direction:column;gap:6px}
    .row label{font-weight:800}

    input,select,textarea{
      padding:10px;border:1px solid var(--bd);border-radius:10px;background:#fff;outline:none;
      font-family:inherit; transition: background .3s,color .3s,border .3s;
    }
    body.dark input,body.dark select,body.dark textarea{
      background:#2a2a2a; border:1px solid #555; color:#f5f5f5;
    }
    textarea{resize:vertical;min-height:90px}

    .submit-wrap{text-align:center;margin-top:14px}
    .btn-submit{
      padding:12px 22px;border:none;border-radius:12px;background:var(--primary);color:#fff;
      font-weight:900;font-size:16px;cursor:pointer;
      box-shadow:0 4px 0 #063fc7, 0 10px 18px var(--shadow);
      transition:transform .08s ease, box-shadow .15s ease;
    }
    .btn-submit:hover{transform:translateY(-1px);}
    .btn-submit:active{transform:scale(.95);}
    body.dark .btn-submit{background:#2563eb;}

    #statusForm{max-width:520px;margin:0 auto 18px;display:none}
    .status-card{max-width:520px;margin:12px auto 0;padding:12px 14px;border-radius:12px;background:#fff;border:1px solid var(--bd)}
    body.dark .status-card{background:#2a2a2a;border:1px solid #555;color:#f5f5f5;}
    .status-row{display:flex;justify-content:space-between;margin:6px 0}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--bd);font-size:12px}

    /* âœ… é™„ä»¶åˆ—è¡¨æ ·å¼ */
    #fileList li {
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:4px 8px;
      margin:3px 0;
      background:#f3f4f6;
      border-radius:6px;
    }
    body.dark #fileList li { background:#333; }
    .remove-btn {
      cursor:pointer;
      color:red;
      font-weight:bold;
      margin-left:10px;
    }
  </style>
</head>
<body>
  <!-- ğŸŒ— åˆ‡æ¢ä¸»é¢˜æŒ‰é’® -->
  <button class="toggle-theme" onclick="toggleTheme()">ğŸŒ— åˆ‡æ¢ä¸»é¢˜</button>

  <h1 class="nav-title">é€šç”¨ç”³è¯·è¡¨å•</h1>
  <h3>é€‚ç”¨äºå„ç±»æ´»åŠ¨/èµ„æºç”³è¯·</h3>

  <div class="tabs">
    <button class="btn-tab" onclick="window.location.href='/'">ç”³è¯·è¡¨æ ¼</button>
    <button class="btn-tab" onclick="toggleStatusForm()">æŸ¥è¯¢çŠ¶æ€</button>
  </div>

  <!-- æŸ¥è¯¢çŠ¶æ€è¡¨å• -->
  <form id="statusForm" class="card" onsubmit="return false">
    <h2><span class="icon">ğŸ”</span>æŸ¥è¯¢å®¡æ ¸çŠ¶æ€</h2>
    <div class="row">
      <label for="status_name">å§“å *</label>
      <input type="text" id="status_name" required>
    </div>
    <div class="submit-wrap"><button class="btn-submit" type="button" onclick="doLookup()">æŸ¥è¯¢</button></div>
    <div id="statusResult" class="status-card" style="display:none;"></div>
  </form>

  <!-- ä¸»è¡¨å• -->
  <form action="/submit" method="post" id="mainForm" enctype="multipart/form-data">
    <!-- ä¸Šä¼ é™„ä»¶ -->
    <section class="card">
      <h2><span class="icon">ğŸ“</span>ä¸Šä¼ é™„ä»¶</h2>
      <div class="row" id="fileUploadArea">
        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
          <input type="file" id="fileInput" name="attachments" accept=".pdf,.doc,.docx,.jpg,.png,.jpeg" multiple>
          <span id="fileCount" class="muted">0/5</span>
        </div>
        <ul id="fileList" class="muted" style="margin-top:8px; list-style:none; padding:0;"></ul>
      </div>
      <p class="muted">ï¼ˆæœ€å¤šä¸Šä¼  5 ä¸ªæ–‡ä»¶ï¼Œå¦‚æ´»åŠ¨æ–¹æ¡ˆã€é¢„ç®—ã€ç›¸å…³è¯æ˜ç­‰ï¼‰</p>
    </section>

    <!-- å…¶ä»–ä¿¡æ¯ -->
    <section class="card">
      <h2><span class="icon">â„¹ï¸</span>å…¶ä»–ä¿¡æ¯</h2>
      <div class="grid-2">
        <div class="row"><label>å¤‡æ³¨</label><textarea name="remarks"></textarea></div>
        <div class="row"><label>ç´§æ€¥è”ç³»äººå§“å</label><input type="text" name="emergency_name"></div>
        <div class="row"><label>ç´§æ€¥è”ç³»äººç”µè¯</label><input type="text" name="emergency_phone"></div>
      </div>
    </section>

    <div class="submit-wrap"><button class="btn-submit" type="submit">æäº¤ç”³è¯·</button></div>
  </form>

<script>
function toggleStatusForm(){
  const f=document.getElementById('statusForm');
  f.style.display=(f.style.display==='none'||!f.style.display)?'block':'none';
}
async function doLookup(){
  const name=(document.getElementById('status_name').value||'').trim();
  const box=document.getElementById('statusResult');
  if(!name){ box.style.display='block'; box.textContent='è¯·è¾“å…¥å§“å'; return; }
  box.style.display='block'; box.textContent='æŸ¥è¯¢ä¸­...';
  try{
    const res=await fetch(`/check_status_api?name=${encodeURIComponent(name)}`);
    const data=await res.json();
    if(!data||!data.status){ box.textContent='æœåŠ¡å™¨è¿”å›å¼‚å¸¸'; return; }
    if(data.status==='not_found'){ box.textContent=`æœªæ‰¾åˆ°ã€${name}ã€‘çš„ç”³è¯·è®°å½•ã€‚`; return;}
    if(data.status==='error'){ box.textContent=data.message||'æŸ¥è¯¢å‡ºé”™'; return;}
    const s=data.data.review_status||'';
    box.innerHTML=
      `<div class="status-row"><span class="muted">å§“å</span><b>${data.data.name}</b></div>
       <div class="status-row"><span class="muted">äº‹é¡¹</span><b>${data.data.event_name||'-'}</b></div>
       <div class="status-row"><span class="muted">å®¡æ ¸çŠ¶æ€</span><span class="badge">${s}</span></div>
       <div class="status-row"><span class="muted">å®¡æ ¸è¯´æ˜</span><b>${data.data.review_comment||'æ— '}</b></div>`;
  }catch(e){ box.textContent='ç½‘ç»œæˆ–æœåŠ¡å™¨å¼‚å¸¸'; }
}
function toggleTheme(){
  document.body.classList.toggle("dark");
}

// âœ… é™„ä»¶æœ€å¤š 5 ä¸ªï¼Œæ˜¾ç¤ºæ–‡ä»¶å + æ•°é‡ + åˆ é™¤æŒ‰é’®
const fileInput = document.getElementById("fileInput");
const fileList = document.getElementById("fileList");
const fileCount = document.getElementById("fileCount");
let uploadedFiles = [];

fileInput.addEventListener("change", function(){
  const newFiles = Array.from(this.files);
  if(uploadedFiles.length + newFiles.length > 5){
    alert("æœ€å¤šåªèƒ½ä¸Šä¼  5 ä¸ªæ–‡ä»¶ï¼");
    this.value = "";
    return;
  }
  uploadedFiles = uploadedFiles.concat(newFiles);
  renderFileList();
  this.value = "";
});

function renderFileList(){
  fileList.innerHTML = "";
  uploadedFiles.forEach((f,i)=>{
    const li = document.createElement("li");
    li.textContent = f.name;
    const removeBtn = document.createElement("span");
    removeBtn.textContent = "Ã—";
    removeBtn.className = "remove-btn";
    removeBtn.onclick = ()=> removeFile(i);
    li.appendChild(removeBtn);
    fileList.appendChild(li);
  });
  fileCount.textContent = `${uploadedFiles.length}/5`;
}

function removeFile(index){
  uploadedFiles.splice(index,1);
  renderFileList();
}
</script>
</body>
</html>
