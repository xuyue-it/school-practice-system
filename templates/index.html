<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>通用申请表单</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    :root{
      --card:#fff; --bd:#e5e5e5; --muted:#666;
      --primary:#0a58ff; --shadow:rgba(0,0,0,.12);
    }
    body{background:#f7f7f7;color:#000;padding:24px;}
    h1,h2,h3,label,.muted,.tabs button,.nav-title{font-family:"Microsoft YaHei","微软雅黑",sans-serif;}
    h1{font-size:32px;font-weight:900;text-align:center;margin:0 0 6px}
    h3{font-size:16px;text-align:center;margin:0 0 18px;color:#444;font-weight:700}
    .tabs{display:flex;justify-content:center;gap:14px;margin:10px 0 22px}
    .btn-tab{
      position:relative; padding:10px 18px; border-radius:12px; border:1px solid var(--bd);
      background:#fff; cursor:pointer; font-weight:800;
      box-shadow:0 3px 0 #cfd6ff, 0 8px 16px var(--shadow);
      transition:transform .08s ease, box-shadow .15s ease;
    }
    .btn-tab:hover{transform:translateY(-1px); box-shadow:0 4px 0 #c5ceff,0 10px 18px var(--shadow);}
    .btn-tab:active{transform:translateY(2px); box-shadow:0 1px 0 #c5ceff,0 4px 10px var(--shadow);}
    form{max-width:1000px;margin:0 auto}
    .card{background:#fff;border:1px solid var(--bd);border-radius:16px;padding:16px 18px;margin-bottom:16px;box-shadow:0 6px 16px var(--shadow)}
    .card h2{display:flex;align-items:center;gap:10px;font-size:20px;font-weight:900;margin:0 0 12px}
    .icon{width:22px;height:22px;display:inline-flex;align-items:center;justify-content:center}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row{display:flex;flex-direction:column;gap:6px}
    .row label{font-weight:800}
    input,select,textarea{
      padding:10px;border:1px solid var(--bd);border-radius:10px;background:#fff;outline:none;
      font-family:inherit;
    }
    textarea{resize:vertical;min-height:90px}
    .submit-wrap{text-align:center;margin-top:14px}
    .btn-submit{
      padding:12px 22px;border:none;border-radius:12px;background:var(--primary);color:#fff;
      font-weight:900;font-size:16px;cursor:pointer;
      box-shadow:0 4px 0 #063fc7, 0 10px 18px var(--shadow);
      transition:transform .08s ease, box-shadow .15s ease;
    }
    .btn-submit:hover{transform:translateY(-1px); box-shadow:0 5px 0 #063fc7,0 12px 20px var(--shadow);}
    .btn-submit:active{transform:translateY(2px); box-shadow:0 2px 0 #063fc7,0 6px 12px var(--shadow);}
    #statusForm{max-width:520px;margin:0 auto 18px;display:none}
    .status-card{max-width:520px;margin:12px auto 0;padding:12px 14px;border-radius:12px;background:#fff;border:1px solid var(--bd)}
    .status-row{display:flex;justify-content:space-between;margin:6px 0}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--bd);font-size:12px}
  </style>
</head>
<body>
  <h1 class="nav-title">通用申请表单</h1>
  <h3>适用于各类活动/资源申请</h3>

  <div class="tabs">
    <button class="btn-tab" onclick="window.location.href='/'">申请表格</button>
    <button class="btn-tab" onclick="toggleStatusForm()">查询状态</button>
  </div>

  <!-- 查询状态表单 -->
  <form id="statusForm" class="card" onsubmit="return false">
    <h2><span class="icon">🔍</span>查询审核状态</h2>
    <div class="row">
      <label for="status_name">姓名 *</label>
      <input type="text" id="status_name" required>
    </div>
    <div class="submit-wrap"><button class="btn-submit" type="button" onclick="doLookup()">查询</button></div>
    <div id="statusResult" class="status-card" style="display:none;"></div>
  </form>

  <!-- 主表单 -->
  <form action="/submit" method="post" id="mainForm" enctype="multipart/form-data">
    <!-- 申请人信息 -->
    <section class="card">
      <h2><span class="icon">👤</span>申请人信息</h2>
      <div class="grid-2">
        <div class="row"><label>姓名 *</label><input type="text" name="name" required></div>
        <div class="row"><label>联系电话 *</label><input type="tel" name="phone" required></div>
        <div class="row"><label>电子邮箱 *</label><input type="email" name="email" required></div>
        <div class="row"><label>所属团体/组织</label><input type="text" name="group"></div>
      </div>
    </section>

    <!-- 活动信息 -->
    <section class="card">
      <h2><span class="icon">📅</span>事项信息</h2>
      <div class="grid-2">
        <div class="row"><label>事项/活动名称 *</label><input type="text" name="event_name" required></div>
        <div class="row"><label>地点 *</label><input type="text" name="location" required></div>
        <div class="row"><label>开始日期 *</label><input type="date" name="start_date" required></div>
        <div class="row"><label>开始时间 *</label><input type="time" name="start_time" required></div>
        <div class="row"><label>结束日期 *</label><input type="date" name="end_date" required></div>
        <div class="row"><label>结束时间 *</label><input type="time" name="end_time" required></div>
        <div class="row"><label>类别 *</label>
          <select name="event_type" required>
            <option value="">请选择类别</option>
            <option value="活动">活动</option>
            <option value="资源申请">资源申请</option>
            <option value="其他">其他</option>
          </select>
        </div>
        <div class="row"><label>预计参与人数 *</label><input type="number" name="participants" min="1" step="1" required></div>
      </div>
    </section>

    <!-- 器材申请 -->
    <section class="card">
      <h2><span class="icon">🎤</span>器材申请</h2>
      <div class="grid-2">
        <div class="row">
          <label><input type="checkbox" name="equip_projector"> 投影机</label>
          <input type="number" name="equip_projector_qty" min="1" placeholder="数量">
        </div>
        <div class="row">
          <label><input type="checkbox" name="equip_screen"> 投影屏幕</label>
          <input type="number" name="equip_screen_qty" min="1" placeholder="数量">
        </div>
        <div class="row">
          <label><input type="checkbox" name="equip_mic_wireless"> 无线麦克风</label>
          <input type="number" name="equip_mic_wireless_qty" min="1" placeholder="数量">
        </div>
        <div class="row">
          <label><input type="checkbox" name="equip_mic_wired"> 有线麦克风</label>
          <input type="number" name="equip_mic_wired_qty" min="1" placeholder="数量">
        </div>
      </div>
    </section>

    <!-- 申请说明 -->
    <section class="card">
      <h2><span class="icon">📝</span>申请说明</h2>
      <div class="row"><label>说明 *</label><textarea name="special_request" required></textarea></div>
    </section>

    <!-- 上传附件 -->
    <section class="card">
      <h2><span class="icon">📎</span>上传附件</h2>
      <div class="row">
        <input type="file" name="attachment" accept=".pdf,.doc,.docx,.jpg,.png,.jpeg">
      </div>
      <p class="muted">（可选：上传活动方案、预算、相关证明等）</p>
    </section>

    <!-- 其他信息 -->
    <section class="card">
      <h2><span class="icon">ℹ️</span>其他信息</h2>
      <div class="grid-2">
        <div class="row"><label>备注</label><textarea name="remarks"></textarea></div>
        <div class="row"><label>紧急联系人姓名</label><input type="text" name="emergency_name"></div>
        <div class="row"><label>紧急联系人电话</label><input type="text" name="emergency_phone"></div>
      </div>
    </section>

    <div class="submit-wrap"><button class="btn-submit" type="submit">提交申请</button></div>
  </form>

<script>
function toggleStatusForm(){
  const f=document.getElementById('statusForm');
  f.style.display=(f.style.display==='none'||!f.style.display)?'block':'none';
}
async function doLookup(){
  const name=(document.getElementById('status_name').value||'').trim();
  const box=document.getElementById('statusResult');
  if(!name){ box.style.display='block'; box.textContent='请输入姓名'; return; }
  box.style.display='block'; box.textContent='查询中...';
  try{
    const res=await fetch(`/check_status_api?name=${encodeURIComponent(name)}`);
    const data=await res.json();
    if(!data||!data.status){ box.textContent='服务器返回异常'; return; }
    if(data.status==='not_found'){ box.textContent=`未找到【${name}】的申请记录。`; return;}
    if(data.status==='error'){ box.textContent=data.message||'查询出错'; return;}
    const s=data.data.review_status||'';
    box.innerHTML=
      `<div class="status-row"><span class="muted">姓名</span><b>${data.data.name}</b></div>
       <div class="status-row"><span class="muted">事项</span><b>${data.data.event_name||'-'}</b></div>
       <div class="status-row"><span class="muted">审核状态</span><span class="badge">${s}</span></div>
       <div class="status-row"><span class="muted">审核说明</span><b>${data.data.review_comment||'无'}</b></div>`;
  }catch(e){ box.textContent='网络或服务器异常'; }
}
</script>
</body>
</html>
