<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>{{ form_name }} - åŠ¨æ€è¡¨å•ç®¡ç†</title>
  <style>
    body {
      font-family:"Microsoft YaHei", sans-serif;
      background:#f5f7fb;
      margin:20px;
      color:#111;
    }
    h1 {
      text-align:center;
      font-weight:900;
      margin-bottom:20px;
    }
    .topbar {
      display:flex;
      justify-content:center;
      gap:16px;
      margin-bottom:20px;
    }
    .topbar a {
      text-decoration:none;
      padding:8px 14px;
      border-radius:8px;
      background:#2563eb;
      color:white;
      font-weight:600;
    }
    .topbar a:hover { background:#1d4ed8; }

    table {
      width:100%;
      border-collapse:collapse;
      background:#fff;
      border-radius:10px;
      box-shadow:0 4px 10px rgba(0,0,0,.08);
      overflow:hidden;
      table-layout:auto;         /* è‡ªåŠ¨åˆ—å®½ */
      word-break:break-word;     /* å†…å®¹è¿‡é•¿è‡ªåŠ¨æ¢è¡Œ */
    }
    th, td {
      padding:10px;
      border:1px solid #ddd;
      text-align:center;
      font-size:14px;
    }
    th {
      background:#f1f5f9;
      font-weight:700;
    }
    tr:nth-child(even) { background:#f9fafb; }

    .badge {
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:600;
    }
    .badge-pending { background:#facc15; color:#111; }   /* å¾…å®¡æ ¸ é»„ */
    .badge-approved { background:#16a34a; color:#fff; } /* é€šè¿‡ ç»¿ */
    .badge-rejected { background:#dc2626; color:#fff; } /* ä¸é€šè¿‡ çº¢ */

    input.comment {
      width:100px;
      padding:4px;
      border-radius:6px;
      border:1px solid #ccc;
    }
    .btn {
      padding:6px 10px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      margin-top:4px;
    }
    .btn-approve { background:#22c55e; color:#fff; }
    .btn-reject { background:#ef4444; color:#fff; }
    .btn-delete { background:#f59e0b; color:#111; }
    .btn:hover { opacity:0.9; }
  </style>
</head>
<body>
  <h1>ğŸ“Š {{ form_name }} - æäº¤ç®¡ç†</h1>

  <div class="topbar">
    <a href="/">ğŸ  è¿”å›é¦–é¡µ</a>
    <a href="/site/{{ site_name }}/admin/users">ğŸ‘¥ ç”¨æˆ·ç®¡ç†</a>
    <a href="/logout/{{ site_name }}">ğŸšª é€€å‡ºç™»å½•</a>
  </div>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>æäº¤ç”¨æˆ·</th>
        <th>æäº¤æ—¶é—´</th>
        {% for f in field_order %}
          <th>{{ field_labels[f] }}</th>
        {% endfor %}
        <th>çŠ¶æ€</th>
        <th>å®¡æ ¸è¯´æ˜</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for s in submissions %}
      <tr id="row-{{ s[0] }}">
        <td>{{ s[0] }}</td>
        <td>{{ s[1] }}</td>
        <td>{{ s[5] }}</td>
        {% for f in field_order %}
          <td>{{ s[2][f] }}</td>
        {% endfor %}
        <td>
          {% if s[3] == "å¾…å®¡æ ¸" %}
            <span class="badge badge-pending">ğŸŸ¡ å¾…å®¡æ ¸</span>
          {% elif s[3] == "é€šè¿‡" %}
            <span class="badge badge-approved">ğŸŸ¢ å·²é€šè¿‡</span>
          {% elif s[3] == "ä¸é€šè¿‡" %}
            <span class="badge badge-rejected">ğŸ”´ å·²æ‹’ç»</span>
          {% else %}
            {{ s[3] }}
          {% endif %}
        </td>
        <td>{{ s[4] or "" }}</td>
        <td>
          <input type="text" id="comment-{{ s[0] }}" class="comment" placeholder="è¯´æ˜">
          <br>
          <button class="btn btn-approve" onclick="updateStatus({{ form_id }}, {{ s[0] }}, 'é€šè¿‡')">é€šè¿‡</button>
          <button class="btn btn-reject" onclick="updateStatus({{ form_id }}, {{ s[0] }}, 'ä¸é€šè¿‡')">ä¸é€šè¿‡</button>
          <button class="btn btn-delete" onclick="deleteSubmission({{ form_id }}, {{ s[0] }})">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

<script>
async function updateStatus(form_id, sub_id, status){
  const comment = document.getElementById(`comment-${sub_id}`).value;
  const res = await fetch(`/form/${form_id}/update_status/${sub_id}`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({status:status, comment:comment})
  });
  const data = await res.json();
  if(data.success){
    alert("âœ… çŠ¶æ€å·²æ›´æ–°ä¸º " + status);
    location.reload();
  } else {
    alert("âŒ " + (data.message || "æ›´æ–°å¤±è´¥"));
  }
}

async function deleteSubmission(form_id, sub_id){
  if(!confirm("ç¡®å®šåˆ é™¤è¯¥æäº¤ï¼Ÿ")) return;
  const res = await fetch(`/form/${form_id}/delete/${sub_id}`, {method:"POST"});
  const data = await res.json();
  if(data.success){
    document.getElementById("row-"+sub_id).remove();
    alert("âœ… å·²åˆ é™¤");
  } else {
    alert("âŒ " + (data.message || "åˆ é™¤å¤±è´¥"));
  }
}
</script>
</body>
</html>
