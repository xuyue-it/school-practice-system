<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>{{ form_name }} - åŠ¨æ€è¡¨å•ç®¡ç†</title>
  <style>
    body { font-family:"Microsoft YaHei", sans-serif; background:#f7f7f7; margin:20px; color:#111; }
    h1 { text-align:center; font-weight:900; margin-bottom:20px; }
    .topbar { display:flex; justify-content:center; gap:16px; margin-bottom:20px; }
    .topbar a { text-decoration:none; padding:8px 14px; border-radius:8px; background:#2563eb; color:white; font-weight:600; }
    .topbar a:hover { background:#1d4ed8; }

    .card {
      background:#fff;
      border-radius:10px;
      box-shadow:0 4px 10px rgba(0,0,0,.08);
      padding:20px;
      margin-bottom:20px;
    }
    .card h2 {
      font-size:18px;
      margin-bottom:10px;
    }
    .field { margin-bottom:10px; }
    .field strong { display:inline-block; width:120px; color:#333; }

    .badge { display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; }
    .badge-pending { background:#facc15; color:#111; }
    .badge-approved { background:#16a34a; color:#fff; }
    .badge-rejected { background:#dc2626; color:#fff; }

    input.comment { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; margin-top:5px; }

    .actions { margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; }
    button { padding:8px 16px; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
    .btn-approve { background:#22c55e; color:#fff; }
    .btn-reject { background:#ef4444; color:#fff; }
    .btn-delete { background:#f59e0b; color:#111; }
    button:hover { opacity:0.9; }
  </style>
</head>
<body>
  <h1>ğŸ“Š {{ form_name }} - æäº¤ç®¡ç†</h1>

  <div class="topbar">
    <a href="/">è¿”å›é¦–é¡µ</a>
    <a href="/admin">å…¨å±€åå°</a>
    <a href="/logout">é€€å‡ºç™»å½•</a>
  </div>

  {% for s in submissions %}
  <div class="card" id="row-{{ s[0] }}">
    <h2>ğŸ“ æäº¤è®°å½• #{{ s[0] }}</h2>
    <div class="field"><strong>æäº¤ç”¨æˆ·:</strong> {{ s[1] }}</div>
    <div class="field"><strong>æäº¤æ—¶é—´:</strong> {{ s[5] }}</div>
    <div class="field"><strong>æ•°æ®å†…å®¹:</strong>
      <pre style="text-align:left; white-space:pre-wrap; font-size:13px;">{{ s[2] }}</pre>
    </div>
    <div class="field">
      <strong>çŠ¶æ€:</strong>
      {% if s[3] == "å¾…å®¡æ ¸" %}
        <span class="badge badge-pending">{{ s[3] }}</span>
      {% elif s[3] == "é€šè¿‡" %}
        <span class="badge badge-approved">{{ s[3] }}</span>
      {% elif s[3] == "ä¸é€šè¿‡" %}
        <span class="badge badge-rejected">{{ s[3] }}</span>
      {% else %}
        {{ s[3] }}
      {% endif %}
    </div>
    <div class="field"><strong>å®¡æ ¸è¯´æ˜:</strong> {{ s[4] or "" }}</div>

    <div class="field">
      <label>âœï¸ å¡«å†™å®¡æ ¸è¯´æ˜:</label>
      <input type="text" id="comment-{{ s[0] }}" class="comment" placeholder="è¯·è¾“å…¥å®¡æ ¸æ„è§">
    </div>

    <div class="actions">
      <button class="btn-approve" onclick="updateStatus({{ form_id }}, {{ s[0] }}, 'é€šè¿‡')">é€šè¿‡</button>
      <button class="btn-reject" onclick="updateStatus({{ form_id }}, {{ s[0] }}, 'ä¸é€šè¿‡')">ä¸é€šè¿‡</button>
      <button class="btn-delete" onclick="deleteSubmission({{ form_id }}, {{ s[0] }})">åˆ é™¤</button>
    </div>
  </div>
  {% endfor %}

<script>
async function updateStatus(form_id, sub_id, status){
  const comment = document.getElementById(`comment-${sub_id}`).value;
  const res = await fetch(`/form/${form_id}/update_status/${sub_id}`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({status:status, comment:comment})
  });
  const data = await res.json();
  if(data.success){
    alert("âœ… çŠ¶æ€å·²æ›´æ–°ä¸º " + status);
    location.reload();
  } else {
    alert("âŒ " + (data.message || "æ›´æ–°å¤±è´¥"));
  }
}

async function deleteSubmission(form_id, sub_id){
  if(!confirm("ç¡®å®šåˆ é™¤è¯¥æäº¤ï¼Ÿ")) return;
  const res = await fetch(`/form/${form_id}/delete/${sub_id}`, {method:"POST"});
  const data = await res.json();
  if(data.success){
    document.getElementById("row-"+sub_id).remove();
    alert("âœ… å·²åˆ é™¤");
  } else {
    alert("âŒ " + (data.message || "åˆ é™¤å¤±è´¥"));
  }
}
</script>
</body>
</html>
